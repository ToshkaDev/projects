general:
  branches:
    only:
      - f-circleci-testing

machine:
  services:
    - docker
  node:
    # Necessary for using the ES6 features of some of our scripts
    version: 6.4
  environment:
    NODE_ENV: develop
    MOCHA_REPORTER: mocha-circleci-reporter
    TZ: America/New_York

dependencies:
  cache_directories:
    - '~/docker'
    - core-lib/node_modules
    - mist-lib/node_modules
    - mist-pipeline/node_modules
    - mist-pipeline/vendor

  override:
    # All tests will be run on the docker image
    - bin/circleci/setup-test-docker-image.sh
    - bin/circleci/detect-projects-to-build.sh > projects-to-build.txt
    - bin/circleci/install-dependencies.sh $(cat projects-to-build.txt)

test:
  override:
    - bin/circleci/run-tests.sh $(cat projects-to-build.txt)
